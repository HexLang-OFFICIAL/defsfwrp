<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>O?WGI?</title>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: monospace, monospace;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      height: 100vh;
      margin: 0;
    }
    h1 {
      text-align: center;
      color: #7f5af0;
      margin-bottom: 1rem;
    }
    #log {
      flex-grow: 1;
      background: #222;
      padding: 1rem;
      border-radius: 8px;
      overflow-y: auto;
      white-space: pre-wrap;
      margin-bottom: 1rem;
      font-size: 1rem;
      line-height: 1.3;
      border: 1px solid #444;
    }
    #input-container {
      display: flex;
      gap: 0.5rem;
    }
    input#prompt {
      flex-grow: 1;
      font-size: 1rem;
      padding: 0.5rem;
      border-radius: 8px;
      border: none;
      outline: none;
      background: #333;
      color: #eee;
    }
    button#sendBtn {
      background: #7f5af0;
      color: white;
      border: none;
      padding: 0 1rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.2s ease;
    }
    button#sendBtn:disabled {
      background: #555;
      cursor: not-allowed;
    }
    button#sendBtn:hover:not(:disabled) {
      background: #6a42e5;
    }
  </style>
</head>
<body>

<h1>Offline? We Got It.</h1>
<div id="log">Loading model... please wait.</div>

<div id="input-container">
  <input type="text" id="prompt" placeholder="Type your message..." disabled autocomplete="off" />
  <button id="sendBtn" disabled>Send</button>
</div>

<script type="module">
  import { GPT4All } from 'https://cdn.jsdelivr.net/npm/gpt4all-js@0.2.5/dist/gpt4all.min.js';

  const log = document.getElementById('log');
  const promptInput = document.getElementById('prompt');
  const sendBtn = document.getElementById('sendBtn');

  let gpt4all;

  function appendMessage(sender, text) {
    log.textContent += `\n${sender}: ${text}`;
    log.scrollTop = log.scrollHeight;
  }

  async function loadModel() {
    try {
      // Create GPT4All instance
      gpt4all = new GPT4All();

      // Load a small model from URL (can swap for your own model URL)
      // Model: GPT4All Llama2 7B
      await gpt4all.loadModel({
        model: 'https://gpt4all.io/models/gpt4all-lora-quantized.bin',
      });

      appendMessage('System', 'Model loaded! You can chat now.');
      promptInput.disabled = false;
      sendBtn.disabled = false;
      promptInput.focus();
    } catch (e) {
      appendMessage('System', `Failed to load model: ${e.message}`);
    }
  }

  async function sendMessage() {
    const userText = promptInput.value.trim();
    if (!userText) return;

    appendMessage('You', userText);
    promptInput.value = '';
    promptInput.disabled = true;
    sendBtn.disabled = true;

    try {
      // Generate response
      const response = await gpt4all.generate(userText, {
        maxTokens: 100,
        temperature: 0.7,
        top_p: 0.9,
      });

      appendMessage('AI', response);
    } catch (e) {
      appendMessage('System', `Error generating response: ${e.message}`);
    } finally {
      promptInput.disabled = false;
      sendBtn.disabled = false;
      promptInput.focus();
    }
  }

  sendBtn.addEventListener('click', sendMessage);
  promptInput.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !sendBtn.disabled) {
      sendMessage();
    }
  });

  loadModel();
</script>

</body>
</html>
